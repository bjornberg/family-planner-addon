<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Family Planner</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        .animate-fadeIn {
            animation: fadeIn 0.3s ease-in;
        }
        .animate-bounce {
            animation: bounce 0.5s ease-in-out 3;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Lucide Icons as inline SVG components
        const Calendar = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                <line x1="16" y1="2" x2="16" y2="6"></line>
                <line x1="8" y1="2" x2="8" y2="6"></line>
                <line x1="3" y1="10" x2="21" y2="10"></line>
            </svg>
        );

        const CheckSquare = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <polyline points="9 11 12 14 22 4"></polyline>
                <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"></path>
            </svg>
        );

        const Plus = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
        );

        const Trash2 = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" y1="11" x2="10" y2="17"></line>
                <line x1="14" y1="11" x2="14" y2="17"></line>
            </svg>
        );

        const BarChart = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" className={className}>
                <line x1="18" y1="20" x2="18" y2="10"></line>
                <line x1="12" y1="20" x2="12" y2="4"></line>
                <line x1="6" y1="20" x2="6" y2="14"></line>
            </svg>
        );

        function FamilyPlanner() {
            const [activeTab, setActiveTab] = useState('calendar');
            const [tasks, setTasks] = useState([]);
            const [recurringTasks, setRecurringTasks] = useState([]);
            const [events, setEvents] = useState([]);
            const [recurringTasksCompleted, setRecurringTasksCompleted] = useState({});
            const [taskHistory, setTaskHistory] = useState({});
            const [newEvent, setNewEvent] = useState({ title: '', date: '', time: '', person: '' });
            const [newTask, setNewTask] = useState({ title: '', person: '', priority: 'normaal', recurring: false, time: '' });
            const [showCelebration, setShowCelebration] = useState(false);
            const [celebrationPerson, setCelebrationPerson] = useState('');
            const [darkMode, setDarkMode] = useState(() => {
                const saved = localStorage.getItem('family_planner_darkmode');
                return saved === 'true';
            });
            const [loaded, setLoaded] = useState(false);

            // Gebruik relatieve URL zodat het werkt in de Home Assistant add-on
            const API_URL = window.location.origin + '/api';

            const familyMembers = ['Bjorn', 'Sanne', 'Jasse', 'Hanna', 'Iedereen'];
            
            const colors = darkMode ? {
                'Bjorn': 'bg-blue-900 border-blue-700',
                'Sanne': 'bg-pink-900 border-pink-700',
                'Jasse': 'bg-green-900 border-green-700',
                'Hanna': 'bg-yellow-900 border-yellow-700',
                'Iedereen': 'bg-purple-900 border-purple-700'
            } : {
                'Bjorn': 'bg-blue-100 border-blue-300',
                'Sanne': 'bg-pink-100 border-pink-300',
                'Jasse': 'bg-green-100 border-green-300',
                'Hanna': 'bg-yellow-100 border-yellow-300',
                'Iedereen': 'bg-purple-100 border-purple-300'
            };

            const personsWithTasks = [...new Set(recurringTasks.map(t => t.person))].filter(Boolean);

            // Load data from server on mount
            useEffect(() => {
                const loadData = async () => {
                    try {
                        const response = await fetch(`${API_URL}/data`);
                        if (response.ok) {
                            const data = await response.json();
                            setEvents(data.events || []);
                            setTasks(data.tasks || []);
                            setRecurringTasks(data.recurring || []);
                            setRecurringTasksCompleted(data.completed || {});
                            setTaskHistory(data.history || {});
                        }
                    } catch (error) {
                        console.error('Fout bij laden van data:', error);
                    } finally {
                        setLoaded(true);
                    }
                };
                loadData();
            }, []);

            // Save data to server when it changes
            useEffect(() => {
                if (!loaded) return; // Don't save during initial load

                const saveData = async () => {
                    try {
                        await fetch(`${API_URL}/data`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                events,
                                tasks,
                                recurring: recurringTasks,
                                completed: recurringTasksCompleted,
                                history: taskHistory
                            })
                        });
                    } catch (error) {
                        console.error('Fout bij opslaan van data:', error);
                    }
                };

                saveData();
            }, [events, tasks, recurringTasks, recurringTasksCompleted, taskHistory, loaded]);

            // Dark mode blijft in localStorage (lokale voorkeur per apparaat)
            useEffect(() => { localStorage.setItem('family_planner_darkmode', darkMode); }, [darkMode]);

            const addEvent = () => {
                if (newEvent.title && newEvent.date) {
                    setEvents([...events, { ...newEvent, id: Date.now() }]);
                    setNewEvent({ title: '', date: '', time: '', person: '' });
                }
            };

            const addTask = () => {
                if (newTask.title) {
                    if (newTask.recurring) {
                        setRecurringTasks([...recurringTasks, { ...newTask, id: Date.now() }]);
                    } else {
                        setTasks([...tasks, { ...newTask, id: Date.now(), completed: false }]);
                    }
                    setNewTask({ title: '', person: '', priority: 'normaal', recurring: false, time: '' });
                }
            };

            const toggleRecurringTask = (id) => {
                const newCompleted = { ...recurringTasksCompleted, [id]: !recurringTasksCompleted[id] };
                setRecurringTasksCompleted(newCompleted);
                const task = recurringTasks.find(t => t.id === id);

                if (task) {
                    const today = new Date().toISOString().split('T')[0];
                    const now = new Date().toLocaleTimeString('nl-NL', { hour: '2-digit', minute: '2-digit' });

                    if (newCompleted[id]) {
                        // Taak voltooid - voeg toe aan geschiedenis
                        const newHistory = { ...taskHistory };
                        if (!newHistory[today]) newHistory[today] = [];

                        const existingIndex = newHistory[today].findIndex(h => h.taskId === id);
                        if (existingIndex === -1) {
                            newHistory[today].push({
                                taskId: id,
                                taskTitle: task.title,
                                person: task.person,
                                completedAt: now
                            });
                        }
                        setTaskHistory(newHistory);

                        const personTasks = recurringTasks.filter(t => t.person === task.person);
                        if (personTasks.every(t => newCompleted[t.id])) {
                            setCelebrationPerson(task.person);
                            setShowCelebration(true);
                            setTimeout(() => setShowCelebration(false), 3000);
                        }
                    } else {
                        // Taak ongedaan gemaakt - verwijder uit geschiedenis
                        const newHistory = { ...taskHistory };
                        if (newHistory[today]) {
                            newHistory[today] = newHistory[today].filter(h => h.taskId !== id);
                            if (newHistory[today].length === 0) delete newHistory[today];
                        }
                        setTaskHistory(newHistory);
                    }
                }
            };

            const quickAddMorningRoutine = (person) => {
                const morningTasks = [
                    { title: 'Aankleden', time: '07:00', priority: 'hoog' },
                    { title: 'Tanden poetsen', time: '07:15', priority: 'hoog' },
                    { title: 'Ontbijten', time: '07:30', priority: 'hoog' },
                    { title: 'Tas inpakken', time: '07:45', priority: 'hoog' }
                ];
                setRecurringTasks([...recurringTasks, ...morningTasks.map(t => ({ ...t, person, recurring: true, id: Date.now() + Math.random() }))]);
            };

            const quickAddEveningRoutine = (person) => {
                const eveningTasks = [
                    { title: 'Pyjama aantrekken', time: '19:30', priority: 'hoog' },
                    { title: 'Tanden poetsen', time: '19:45', priority: 'hoog' },
                    { title: 'Boekje lezen', time: '20:00', priority: 'hoog' }
                ];
                setRecurringTasks([...recurringTasks, ...eveningTasks.map(t => ({ ...t, person, recurring: true, id: Date.now() + Math.random() }))]);
            };

            const getCompletionPercentage = (person) => {
                const personTasks = recurringTasks.filter(t => t.person === person);
                if (personTasks.length === 0) return 0;
                return Math.round((personTasks.filter(t => recurringTasksCompleted[t.id]).length / personTasks.length) * 100);
            };

            const sortedEvents = [...events].sort((a, b) => new Date(a.date) - new Date(b.date));

            return (
                <div className={`min-h-screen p-4 ${darkMode ? 'bg-gradient-to-br from-gray-900 to-gray-800' : 'bg-gradient-to-br from-blue-50 to-purple-50'}`}>
                    {showCelebration && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">
                            <div className={`rounded-3xl p-8 shadow-2xl text-center ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
                                <div className="text-6xl mb-4">üéâüåü‚ú®</div>
                                <h2 className="text-3xl font-bold text-purple-600 mb-2">GELUKT!</h2>
                                <p className={`text-xl ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>{celebrationPerson} heeft alle taken afgerond!</p>
                                <div className="text-5xl mt-4">üèÜüëèüéä</div>
                            </div>
                        </div>
                    )}

                    <div className="max-w-4xl mx-auto">
                        <div className={`rounded-2xl shadow-lg p-6 mb-6 ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
                            <div className="flex justify-between items-center mb-2">
                                <h1 className={`text-3xl font-bold flex-1 ${darkMode ? 'text-gray-100' : 'text-gray-800'}`}>üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family Planner</h1>
                                <button onClick={() => setDarkMode(!darkMode)} className={`p-2 rounded-lg ${darkMode ? 'bg-gray-700 text-yellow-400' : 'bg-gray-200 text-gray-700'}`}>
                                    {darkMode ? '‚òÄÔ∏è' : 'üåô'}
                                </button>
                            </div>
                            <p className={`${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>Samen organiseren, samen groeien</p>
                        </div>

                        <div className="flex gap-4 mb-6">
                            <button onClick={() => setActiveTab('calendar')} className={`flex-1 py-3 rounded-xl font-semibold ${activeTab === 'calendar' ? 'bg-blue-500 text-white shadow-lg' : darkMode ? 'bg-gray-800 text-gray-300' : 'bg-white text-gray-600'}`}>
                                <Calendar size={20} className="inline mr-2" />Kalender
                            </button>
                            <button onClick={() => setActiveTab('tasks')} className={`flex-1 py-3 rounded-xl font-semibold ${activeTab === 'tasks' ? 'bg-purple-500 text-white shadow-lg' : darkMode ? 'bg-gray-800 text-gray-300' : 'bg-white text-gray-600'}`}>
                                <CheckSquare size={20} className="inline mr-2" />Taken
                            </button>
                            <button onClick={() => setActiveTab('week')} className={`flex-1 py-3 rounded-xl font-semibold ${activeTab === 'week' ? 'bg-green-500 text-white shadow-lg' : darkMode ? 'bg-gray-800 text-gray-300' : 'bg-white text-gray-600'}`}>
                                <BarChart size={20} className="inline mr-2" />Week
                            </button>
                        </div>

                        {activeTab === 'calendar' && (
                            <div className="space-y-6">
                                <div className={`rounded-2xl shadow-lg p-6 ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
                                    <h2 className={`text-xl font-bold mb-4 ${darkMode ? 'text-gray-100' : 'text-gray-800'}`}>Nieuwe Afspraak</h2>
                                    <div className="space-y-3">
                                        <input type="text" placeholder="Wat is de afspraak?" value={newEvent.title} onChange={(e) => setNewEvent({ ...newEvent, title: e.target.value })} className={`w-full p-3 border-2 rounded-lg ${darkMode ? 'bg-gray-700 border-gray-600 text-gray-100' : 'bg-white border-gray-200'}`} />
                                        <div className="grid grid-cols-2 gap-3">
                                            <input type="date" value={newEvent.date} onChange={(e) => setNewEvent({ ...newEvent, date: e.target.value })} className={`p-3 border-2 rounded-lg ${darkMode ? 'bg-gray-700 border-gray-600 text-gray-100' : 'bg-white border-gray-200'}`} />
                                            <input type="time" value={newEvent.time} onChange={(e) => setNewEvent({ ...newEvent, time: e.target.value })} className={`p-3 border-2 rounded-lg ${darkMode ? 'bg-gray-700 border-gray-600 text-gray-100' : 'bg-white border-gray-200'}`} />
                                        </div>
                                        <select value={newEvent.person} onChange={(e) => setNewEvent({ ...newEvent, person: e.target.value })} className={`w-full p-3 border-2 rounded-lg ${darkMode ? 'bg-gray-700 border-gray-600 text-gray-100' : 'bg-white border-gray-200'}`}>
                                            <option value="">Voor wie?</option>
                                            {familyMembers.map(m => <option key={m} value={m}>{m}</option>)}
                                        </select>
                                        <button onClick={addEvent} className="w-full bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 rounded-lg flex items-center justify-center gap-2">
                                            <Plus size={20} />Afspraak Toevoegen
                                        </button>
                                    </div>
                                </div>

                                <div className={`rounded-2xl shadow-lg p-6 ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
                                    <h2 className={`text-xl font-bold mb-4 ${darkMode ? 'text-gray-100' : 'text-gray-800'}`}>Komende Afspraken</h2>
                                    {sortedEvents.length === 0 ? (
                                        <p className={`text-center py-8 ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>Nog geen afspraken</p>
                                    ) : (
                                        <div className="space-y-3">
                                            {sortedEvents.map(event => (
                                                <div key={event.id} className={`p-4 rounded-lg border-2 ${colors[event.person] || (darkMode ? 'bg-gray-700 border-gray-600' : 'bg-gray-100 border-gray-300')}`}>
                                                    <div className="flex justify-between">
                                                        <div>
                                                            <h3 className={`font-bold ${darkMode ? 'text-gray-100' : 'text-gray-800'}`}>{event.title}</h3>
                                                            <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                                                                {new Date(event.date).toLocaleDateString('nl-NL', { weekday: 'long', day: 'numeric', month: 'long' })}
                                                                {event.time && ` om ${event.time}`}
                                                            </p>
                                                            <p className={`text-sm font-semibold ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>{event.person}</p>
                                                        </div>
                                                        <button onClick={() => setEvents(events.filter(e => e.id !== event.id))} className="text-red-600"><Trash2 size={18} /></button>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {activeTab === 'tasks' && (
                            <div className="space-y-6">
                                <div className={`rounded-2xl shadow-lg p-6 ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
                                    <h2 className={`text-xl font-bold mb-4 ${darkMode ? 'text-gray-100' : 'text-gray-800'}`}>Nieuwe Taak</h2>
                                    <div className={`mb-4 p-4 border-2 rounded-lg ${darkMode ? 'bg-orange-900 border-orange-700' : 'bg-orange-50 border-orange-200'}`}>
                                        <h3 className={`font-semibold mb-2 ${darkMode ? 'text-gray-100' : 'text-gray-800'}`}>üåÖ Ochtendroutine</h3>
                                        <div className="flex gap-2 flex-wrap">
                                            {['Jasse', 'Hanna'].map(m => (
                                                <button key={m} onClick={() => quickAddMorningRoutine(m)} className="px-4 py-2 bg-orange-400 text-white rounded-lg font-semibold">+ {m}</button>
                                            ))}
                                        </div>
                                    </div>
                                    <div className={`mb-4 p-4 border-2 rounded-lg ${darkMode ? 'bg-indigo-900 border-indigo-700' : 'bg-indigo-50 border-indigo-200'}`}>
                                        <h3 className={`font-semibold mb-2 ${darkMode ? 'text-gray-100' : 'text-gray-800'}`}>üåô Avondroutine</h3>
                                        <div className="flex gap-2 flex-wrap">
                                            {['Jasse', 'Hanna'].map(m => (
                                                <button key={m} onClick={() => quickAddEveningRoutine(m)} className="px-4 py-2 bg-indigo-400 text-white rounded-lg font-semibold">+ {m}</button>
                                            ))}
                                        </div>
                                    </div>
                                    <div className="space-y-3">
                                        <input type="text" placeholder="Wat moet er gedaan worden?" value={newTask.title} onChange={(e) => setNewTask({ ...newTask, title: e.target.value })} className={`w-full p-3 border-2 rounded-lg ${darkMode ? 'bg-gray-700 border-gray-600 text-gray-100' : 'bg-white border-gray-200'}`} />
                                        <div className="grid grid-cols-2 gap-3">
                                            <select value={newTask.person} onChange={(e) => setNewTask({ ...newTask, person: e.target.value })} className={`p-3 border-2 rounded-lg ${darkMode ? 'bg-gray-700 border-gray-600 text-gray-100' : 'bg-white border-gray-200'}`}>
                                                <option value="">Voor wie?</option>
                                                {familyMembers.map(m => <option key={m} value={m}>{m}</option>)}
                                            </select>
                                            <select value={newTask.priority} onChange={(e) => setNewTask({ ...newTask, priority: e.target.value })} className={`p-3 border-2 rounded-lg ${darkMode ? 'bg-gray-700 border-gray-600 text-gray-100' : 'bg-white border-gray-200'}`}>
                                                <option value="laag">üü¢ Laag</option>
                                                <option value="normaal">üü° Normaal</option>
                                                <option value="hoog">üî¥ Hoog</option>
                                            </select>
                                        </div>
                                        <div className={`flex items-center gap-3 p-3 rounded-lg ${darkMode ? 'bg-purple-900' : 'bg-purple-50'}`}>
                                            <input type="checkbox" checked={newTask.recurring} onChange={(e) => setNewTask({ ...newTask, recurring: e.target.checked })} className="w-5 h-5" />
                                            <label className={`font-semibold ${darkMode ? 'text-gray-200' : 'text-gray-700'}`}>üîÑ Dagelijks terugkerend</label>
                                        </div>
                                        {newTask.recurring && <input type="time" value={newTask.time} onChange={(e) => setNewTask({ ...newTask, time: e.target.value })} className={`w-full p-3 border-2 rounded-lg ${darkMode ? 'bg-gray-700 border-gray-600 text-gray-100' : 'bg-white border-gray-200'}`} />}
                                        <button onClick={addTask} className="w-full bg-purple-500 hover:bg-purple-600 text-white font-semibold py-3 rounded-lg flex items-center justify-center gap-2">
                                            <Plus size={20} />Taak Toevoegen
                                        </button>
                                    </div>
                                </div>

                                <div className={`rounded-2xl shadow-lg p-6 ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
                                    <h2 className={`text-xl font-bold mb-4 ${darkMode ? 'text-gray-100' : 'text-gray-800'}`}>Takenlijst</h2>
                                    {recurringTasks.length > 0 && (
                                        <div className="mb-6">
                                            <div className="flex justify-between mb-3">
                                                <h3 className={`text-lg font-bold ${darkMode ? 'text-purple-400' : 'text-purple-700'}`}>üîÑ Dagelijkse Taken</h3>
                                                <button onClick={() => setRecurringTasksCompleted({})} className={`text-sm px-3 py-1 rounded-lg ${darkMode ? 'bg-gray-700 text-gray-300' : 'bg-gray-200 text-gray-700'}`}>üîÑ Reset</button>
                                            </div>
                                            {personsWithTasks.map(person => (
                                                <div key={person} className={`p-3 rounded-lg mb-2 ${colors[person]}`}>
                                                    <div className="flex justify-between mb-1">
                                                        <span className={`font-semibold ${darkMode ? 'text-gray-200' : 'text-gray-700'}`}>{person}</span>
                                                        <span className={`text-sm font-bold ${darkMode ? 'text-gray-200' : 'text-gray-700'}`}>{getCompletionPercentage(person)}%</span>
                                                    </div>
                                                    <div className={`w-full rounded-full h-3 ${darkMode ? 'bg-gray-700' : 'bg-white'}`}>
                                                        <div className={`h-full transition-all duration-500 ${getCompletionPercentage(person) === 100 ? 'bg-green-500' : 'bg-purple-500'}`} style={{ width: `${getCompletionPercentage(person)}%` }} />
                                                    </div>
                                                </div>
                                            ))}
                                            <div className="space-y-3 mt-3">
                                                {recurringTasks.map(task => (
                                                    <div key={task.id} className={`p-4 rounded-lg border-2 border-l-4 border-l-purple-500 ${recurringTasksCompleted[task.id] ? darkMode ? 'bg-gray-900 border-gray-700 opacity-60' : 'bg-gray-50 border-gray-300 opacity-60' : colors[task.person] || (darkMode ? 'bg-gray-700 border-gray-600' : 'bg-gray-100 border-gray-300')}`}>
                                                        <div className="flex items-start gap-3">
                                                            <input type="checkbox" checked={recurringTasksCompleted[task.id] || false} onChange={() => toggleRecurringTask(task.id)} className="mt-1 w-5 h-5" />
                                                            <div className="flex-1">
                                                                <h3 className={`font-semibold ${recurringTasksCompleted[task.id] ? 'line-through' : ''} ${darkMode ? 'text-gray-100' : 'text-gray-800'}`}>{task.title}</h3>
                                                                <div className="flex gap-2 mt-1">
                                                                    {task.person && <span className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>{task.person}</span>}
                                                                    {task.time && <span className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>‚è∞ {task.time}</span>}
                                                                </div>
                                                            </div>
                                                            <button onClick={() => setRecurringTasks(recurringTasks.filter(t => t.id !== task.id))} className="text-red-600"><Trash2 size={18} /></button>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                    {tasks.length > 0 && (
                                        <div>
                                            <h3 className={`text-lg font-bold mb-3 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>üìù Eenmalige Taken</h3>
                                            <div className="space-y-3">
                                                {tasks.map(task => (
                                                    <div key={task.id} className={`p-4 rounded-lg border-2 ${task.completed ? darkMode ? 'bg-gray-900 border-gray-700 opacity-60' : 'bg-gray-50 border-gray-300 opacity-60' : colors[task.person] || (darkMode ? 'bg-gray-700 border-gray-600' : 'bg-gray-100 border-gray-300')}`}>
                                                        <div className="flex items-start gap-3">
                                                            <input type="checkbox" checked={task.completed} onChange={() => setTasks(tasks.map(t => t.id === task.id ? { ...t, completed: !t.completed } : t))} className="mt-1 w-5 h-5" />
                                                            <div className="flex-1">
                                                                <h3 className={`font-semibold ${task.completed ? 'line-through' : ''} ${darkMode ? 'text-gray-100' : 'text-gray-800'}`}>{task.title}</h3>
                                                                {task.person && <span className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>{task.person}</span>}
                                                            </div>
                                                            <button onClick={() => setTasks(tasks.filter(t => t.id !== task.id))} className="text-red-600"><Trash2 size={18} /></button>
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        )}

                        {activeTab === 'week' && (
                            <div className="space-y-6">
                                <div className={`rounded-2xl shadow-lg p-6 ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
                                    <h2 className={`text-xl font-bold mb-4 ${darkMode ? 'text-gray-100' : 'text-gray-800'}`}>üìä Weekoverzicht</h2>
                                    <div className="space-y-4">
                                        {(() => {
                                            const days = [];
                                            for (let i = 6; i >= 0; i--) {
                                                const date = new Date();
                                                date.setDate(date.getDate() - i);
                                                const dateStr = date.toISOString().split('T')[0];
                                                const dayName = date.toLocaleDateString('nl-NL', { weekday: 'long', day: 'numeric', month: 'long' });
                                                const tasksForDay = taskHistory[dateStr] || [];

                                                const isToday = i === 0;

                                                days.push(
                                                    <div key={dateStr} className={`p-4 rounded-lg border-2 ${isToday ? darkMode ? 'border-green-500 bg-gray-700' : 'border-green-500 bg-green-50' : darkMode ? 'border-gray-600 bg-gray-900' : 'border-gray-300 bg-gray-50'}`}>
                                                        <div className="flex justify-between items-center mb-3">
                                                            <h3 className={`font-bold ${darkMode ? 'text-gray-100' : 'text-gray-800'}`}>
                                                                {isToday ? 'üéØ ' : ''}{dayName}
                                                            </h3>
                                                            <span className={`px-3 py-1 rounded-full text-sm font-bold ${tasksForDay.length > 0 ? 'bg-green-500 text-white' : darkMode ? 'bg-gray-700 text-gray-400' : 'bg-gray-300 text-gray-600'}`}>
                                                                {tasksForDay.length} {tasksForDay.length === 1 ? 'taak' : 'taken'}
                                                            </span>
                                                        </div>

                                                        {tasksForDay.length === 0 ? (
                                                            <p className={`text-sm italic ${darkMode ? 'text-gray-500' : 'text-gray-400'}`}>Geen taken voltooid</p>
                                                        ) : (
                                                            <div className="space-y-2">
                                                                {familyMembers.filter(m => m !== 'Iedereen').map(person => {
                                                                    const personTasks = tasksForDay.filter(t => t.person === person);
                                                                    if (personTasks.length === 0) return null;

                                                                    return (
                                                                        <div key={person} className={`p-2 rounded ${colors[person]}`}>
                                                                            <div className="flex justify-between items-center mb-1">
                                                                                <span className={`font-semibold ${darkMode ? 'text-gray-200' : 'text-gray-800'}`}>{person}</span>
                                                                                <span className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>‚úÖ {personTasks.length}</span>
                                                                            </div>
                                                                            <div className="space-y-1">
                                                                                {personTasks.map((task, idx) => (
                                                                                    <div key={idx} className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                                                                                        ‚Ä¢ {task.taskTitle} <span className={`text-xs ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>({task.completedAt})</span>
                                                                                    </div>
                                                                                ))}
                                                                            </div>
                                                                        </div>
                                                                    );
                                                                })}
                                                            </div>
                                                        )}
                                                    </div>
                                                );
                                            }
                                            return days;
                                        })()}
                                    </div>
                                </div>

                                <div className={`rounded-2xl shadow-lg p-6 ${darkMode ? 'bg-gray-800' : 'bg-white'}`}>
                                    <h2 className={`text-xl font-bold mb-4 ${darkMode ? 'text-gray-100' : 'text-gray-800'}`}>üìà Statistieken deze Week</h2>
                                    <div className="space-y-3">
                                        {familyMembers.filter(m => m !== 'Iedereen').map(person => {
                                            const totalTasks = Object.values(taskHistory)
                                                .flat()
                                                .filter(t => t.person === person)
                                                .length;

                                            return (
                                                <div key={person} className={`p-3 rounded-lg ${colors[person]}`}>
                                                    <div className="flex justify-between items-center">
                                                        <span className={`font-bold ${darkMode ? 'text-gray-200' : 'text-gray-800'}`}>{person}</span>
                                                        <span className={`text-lg font-bold ${darkMode ? 'text-gray-200' : 'text-gray-800'}`}>{totalTasks} taken ‚úÖ</span>
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>

                                <div className={`rounded-2xl shadow-lg p-6 ${darkMode ? 'bg-gradient-to-br from-yellow-900 to-orange-900' : 'bg-gradient-to-br from-yellow-100 to-orange-100'}`}>
                                    <h2 className={`text-2xl font-bold mb-4 text-center ${darkMode ? 'text-yellow-300' : 'text-orange-800'}`}>üèÜ Totale Puntenscore üèÜ</h2>
                                    <p className={`text-center mb-4 text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>Elke voltooide taak = 1 punt</p>
                                    <div className="space-y-3">
                                        {(() => {
                                            const scores = familyMembers
                                                .filter(m => m !== 'Iedereen')
                                                .map(person => ({
                                                    person,
                                                    points: Object.values(taskHistory)
                                                        .flat()
                                                        .filter(t => t.person === person)
                                                        .length
                                                }))
                                                .sort((a, b) => b.points - a.points);

                                            const medals = ['ü•á', 'ü•à', 'ü•â', 'üèÖ'];

                                            return scores.map((score, index) => (
                                                <div key={score.person} className={`p-4 rounded-lg ${colors[score.person]} border-2 ${index === 0 ? 'border-yellow-500 shadow-lg scale-105' : darkMode ? 'border-gray-600' : 'border-gray-300'}`}>
                                                    <div className="flex justify-between items-center">
                                                        <div className="flex items-center gap-3">
                                                            <span className="text-3xl">{medals[index] || 'üèÖ'}</span>
                                                            <div>
                                                                <div className={`font-bold text-lg ${darkMode ? 'text-gray-100' : 'text-gray-800'}`}>{score.person}</div>
                                                                <div className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>#{index + 1}</div>
                                                            </div>
                                                        </div>
                                                        <div className="text-right">
                                                            <div className={`text-3xl font-bold ${darkMode ? 'text-yellow-300' : 'text-orange-600'}`}>{score.points}</div>
                                                            <div className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>punten</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            ));
                                        })()}
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<FamilyPlanner />, document.getElementById('root'));
    </script>
</body>
</html>